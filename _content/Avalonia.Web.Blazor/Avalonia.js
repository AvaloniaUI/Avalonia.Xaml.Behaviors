var l=class{static getDpi(){return window.devicePixelRatio}static start(t){return l.lastDpi=window.devicePixelRatio,l.timerId=window.setInterval(l.update,1e3),l.callback=t,l.lastDpi}static stop(){window.clearInterval(l.timerId),l.callback=void 0}static update(){if(!l.callback)return;let t=window.devicePixelRatio,e=l.lastDpi;l.lastDpi=t,Math.abs(e-t)>.001&&l.callback.invokeMethod("Invoke",e,t)}};var b=class{static getCaretCoordinates(t,e,n){var L;if(!E)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");let i=n&&n.debug||!1;if(i){let m=document.querySelector("#input-textarea-caret-position-mirror-div");m&&((L=m.parentNode)==null||L.removeChild(m))}let o=document.createElement("div");o.id="input-textarea-caret-position-mirror-div",document.body.appendChild(o);let a=o.style,r=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,u=t.nodeName==="INPUT";a.whiteSpace="pre-wrap",u||(a.wordWrap="break-word"),a.position="absolute",i||(a.visibility="hidden"),y.forEach(m=>{if(u&&m==="lineHeight")if(r.boxSizing==="border-box"){let f=parseInt(r.height),x=parseInt(r.paddingTop)+parseInt(r.paddingBottom)+parseInt(r.borderTopWidth)+parseInt(r.borderBottomWidth),w=x+parseInt(r.lineHeight);f>w?a.lineHeight=f-x+"px":f===w?a.lineHeight=r.lineHeight:a.lineHeight="0"}else a.lineHeight=r.height;else a[m]=r[m]}),I?t.scrollHeight>parseInt(r.height)&&(a.overflowY="scroll"):a.overflow="hidden",o.textContent=t.value.substring(0,e),u&&(o.textContent=o.textContent.replace(/\s/g,"\xA0"));let h=document.createElement("span");h.textContent=t.value.substring(e)||".",o.appendChild(h);let H={top:h.offsetTop+parseInt(r.borderTopWidth),left:h.offsetLeft+parseInt(r.borderLeftWidth),height:parseInt(r.lineHeight)};return i?h.style.backgroundColor="#aaa":document.body.removeChild(o),H}},y=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],E=typeof window!="undefined",I=E&&window.mozInnerScreenX!=null;var c=class{static start(t,e,n){c.compositionCallback=e,t.addEventListener("compositionstart",c.onCompositionEvent),t.addEventListener("compositionupdate",c.onCompositionEvent),t.addEventListener("compositionend",c.onCompositionEvent),c.inputCallback=n,t.addEventListener("input",c.onInputEvent)}static clear(t){t.value=""}static focus(t){t.focus()}static setCursor(t,e){t.style.cursor=e}static setBounds(t,e,n,i,o,a){t.style.left=e.toFixed(0)+"px",t.style.top=n.toFixed(0)+"px";let{height:r,left:u,top:h}=b.getCaretCoordinates(t,a);t.style.left=(e-u).toFixed(0)+"px",t.style.top=(n-h).toFixed(0)+"px"}static hide(t){t.style.display="none"}static show(t){t.style.display="block"}static setSurroundingText(t,e,n,i){!t||(t.value=e,t.setSelectionRange(n,i),t.style.width="20px",t.style.width=t.scrollWidth+"px")}static onCompositionEvent(t){if(!!c.compositionCallback)switch(t.type){case"compositionstart":case"compositionupdate":case"compositionend":c.compositionCallback.invokeMethod("Invoke",t.type,t.data);break}}static onInputEvent(t){if(!!c.inputCallback){var e=t;c.inputCallback.invokeMethod("Invoke",t.type,e.data)}}};var v=class{static focus(t){t.focus()}static setCursor(t,e){t.style.cursor=e}};var C=class{static CreateDefaultChild(t){return document.createElement("div")}static GetReference(t){return t}static CreateAttachment(){return new g}},g=class{InitializeWithChildHandle(t){this._child=t,this._child.style.position="absolute"}AttachTo(t){this._host&&this._child&&this._host.removeChild(this._child),this._host=t,this._host&&this._child&&this._host.appendChild(this._child)}ShowInBounds(t,e,n,i){this._child&&(this._child.style.top=e+"px",this._child.style.left=t+"px",this._child.style.width=n+"px",this._child.style.height=i+"px",this._child.style.display="block")}HideWithSize(t,e){this._child&&(this._child.style.width=t+"px",this._child.style.height=e+"px",this._child.style.display="none")}ReleaseChild(){this._child&&(this._child=void 0)}};var s=class{static observe(t,e,n){if(!t||!n)return;s.init();let i=t;i.SizeWatcher={callback:n},s.elements.set(e,t),s.observer.observe(t),s.invoke(t)}static unobserve(t){if(!t||!s.observer)return;let e=s.elements.get(t);s.elements.delete(t),s.observer.unobserve(e)}static init(){s.observer||(s.elements=new Map,s.observer=new ResizeObserver(t=>{for(let e of t)s.invoke(e.target)}))}static invoke(t){let n=t.SizeWatcher;if(!(!n||!n.callback))return n.callback.invokeMethod("Invoke",t.clientWidth,t.clientHeight)}};var d=class{constructor(t,e,n){this.renderLoopEnabled=!1;this.renderLoopRequest=0;if(this.htmlCanvas=e,this.renderFrameCallback=n,t){let i=d.createWebGLContext(this.htmlCanvas);if(!i){console.error(`Failed to create WebGL context: err ${i}`);return}GL.makeContextCurrent(i);let o=GLctx.getParameter(GLctx.FRAMEBUFFER_BINDING);this.glInfo={context:i,fboId:o?o.id:0,stencil:GLctx.getParameter(GLctx.STENCIL_BITS),sample:0,depth:GLctx.getParameter(GLctx.DEPTH_BITS)}}}static initGL(t,e,n){var i=d.init(!0,t,e,n);return!i||!i.glInfo?null:i.glInfo}static initRaster(t,e,n){var i=d.init(!1,t,e,n);return!!i}static init(t,e,n,i){var o=e;if(!o)return console.error("No canvas element was provided."),null;d.elements||(d.elements=new Map),d.elements.set(n,e);let a=new d(t,e,i);return o.SKHtmlCanvas=a,a}static deinit(t){if(!t)return;let e=d.elements.get(t);d.elements.delete(t);let n=e;!n||!n.SKHtmlCanvas||(n.SKHtmlCanvas.deinit(),n.SKHtmlCanvas=void 0)}static requestAnimationFrame(t,e){let n=t;!n||!n.SKHtmlCanvas||n.SKHtmlCanvas.requestAnimationFrame(e)}static setCanvasSize(t,e,n){let i=t;!i||!i.SKHtmlCanvas||i.SKHtmlCanvas.setCanvasSize(e,n)}static setEnableRenderLoop(t,e){let n=t;!n||!n.SKHtmlCanvas||n.SKHtmlCanvas.setEnableRenderLoop(e)}static putImageData(t,e,n,i){let o=t;!o||!o.SKHtmlCanvas||o.SKHtmlCanvas.putImageData(e,n,i)}deinit(){this.setEnableRenderLoop(!1)}setCanvasSize(t,e){this.newWidth=t,this.newHeight=e,this.htmlCanvas.width!=this.newWidth&&(this.htmlCanvas.width=this.newWidth),this.htmlCanvas.height!=this.newHeight&&(this.htmlCanvas.height=this.newHeight),this.glInfo&&GL.makeContextCurrent(this.glInfo.context)}requestAnimationFrame(t){t!==void 0&&this.renderLoopEnabled!==t&&this.setEnableRenderLoop(t),this.renderLoopRequest===0&&(this.renderLoopRequest=window.requestAnimationFrame(()=>{this.glInfo&&GL.makeContextCurrent(this.glInfo.context),this.htmlCanvas.width!=this.newWidth&&(this.htmlCanvas.width=this.newWidth||0),this.htmlCanvas.height!=this.newHeight&&(this.htmlCanvas.height=this.newHeight||0),this.renderFrameCallback.invokeMethod("Invoke"),this.renderLoopRequest=0,this.renderLoopEnabled&&this.requestAnimationFrame()}))}setEnableRenderLoop(t){this.renderLoopEnabled=t,t?this.requestAnimationFrame():this.renderLoopRequest!==0&&(window.cancelAnimationFrame(this.renderLoopRequest),this.renderLoopRequest=0)}putImageData(t,e,n){if(this.glInfo||!t||e<=0||e<=0)return!1;var i=this.htmlCanvas.getContext("2d");if(!i)return console.error("Failed to obtain 2D canvas context."),!1;this.htmlCanvas.width=e,this.htmlCanvas.height=n;var o=new Uint8ClampedArray(Module.HEAPU8.buffer,t,e*n*4),a=new ImageData(o,e,n);return i.putImageData(a,0,0),!0}static createWebGLContext(t){let e={alpha:1,depth:1,stencil:8,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,preferLowPowerToHighPerformance:0,failIfMajorPerformanceCaveat:0,majorVersion:2,minorVersion:0,enableExtensionsByDefault:1,explicitSwapControl:0,renderViaOffscreenBackBuffer:1},n=GL.createContext(t,e);return!n&&e.majorVersion>1&&(console.warn("Falling back to WebGL 1.0"),e.majorVersion=1,e.minorVersion=0,n=GL.createContext(t,e)),n}};export{b as CaretHelper,l as DpiWatcher,v as FocusHelper,c as InputHelper,C as NativeControlHost,d as SKHtmlCanvas,s as SizeWatcher};
//# sourceMappingURL=Avalonia.js.map
