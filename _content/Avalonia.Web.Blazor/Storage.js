var c=(a,e,t)=>new Promise((i,n)=>{var o=l=>{try{s(t.next(l))}catch(u){n(u)}},r=l=>{try{s(t.throw(l))}catch(u){n(u)}},s=l=>l.done?i(l.value):Promise.resolve(l.value).then(o,r);s((t=t.apply(a,e)).next())}),g=(a,e,t)=>(e=a[Symbol.asyncIterator],t=(i,n)=>(n=a[i])&&(e[i]=o=>new Promise((r,s,l)=>(o=n.call(a,o),l=o.done,Promise.resolve(o.value).then(u=>r({value:u,done:l}),s)))),e?e.call(a):(a=a[Symbol.iterator](),e={},t("next"),t("return"),e));var h=class{constructor(e){this.database=e}openStore(e,t){return this.database.transaction(e,t).objectStore(e)}put(e,t,i){let n=this.openStore(e,"readwrite");return new Promise((o,r)=>{let s=n.put(t,i);s.onsuccess=()=>{o(s.result)},s.onerror=()=>{r(s.error)}})}get(e,t){let i=this.openStore(e,"readonly");return new Promise((n,o)=>{let r=i.get(t);r.onsuccess=()=>{n(r.result)},r.onerror=()=>{o(r.error)}})}delete(e,t){let i=this.openStore(e,"readwrite");return new Promise((n,o)=>{let r=i.delete(t);r.onsuccess=()=>{n()},r.onerror=()=>{o(r.error)}})}close(){this.database.close()}},m=class{constructor(e,t){this.databaseName=e;this.objectStores=t}connect(){let e=window.indexedDB.open(this.databaseName,1);return e.onupgradeneeded=t=>{let i=t.target.result;this.objectStores.forEach(n=>{i.createObjectStore(n)})},new Promise((t,i)=>{e.onsuccess=n=>{t(new h(n.target.result))},e.onerror=n=>{i(n.target.error)}})}};var w="fileBookmarks",y=new m("AvaloniaDb",[w]),d=class{constructor(e,t){this.handle=e;this.bookmarkId=t}getName(){return this.handle.name}getKind(){return this.handle.kind}openRead(){return c(this,null,function*(){if(!(this.handle instanceof FileSystemFileHandle))throw new Error("StorageItem is not a file");return yield this.verityPermissions("read"),yield this.handle.getFile()})}openWrite(){return c(this,null,function*(){if(!(this.handle instanceof FileSystemFileHandle))throw new Error("StorageItem is not a file");return yield this.verityPermissions("readwrite"),yield this.handle.createWritable({keepExistingData:!0})})}getProperties(){return c(this,null,function*(){let e=this.handle instanceof FileSystemFileHandle&&(yield this.handle.getFile());return e?{Size:e.size,LastModified:e.lastModified,Type:e.type}:null})}getItems(){return c(this,null,function*(){if(this.handle.kind!=="directory")return new p([]);let e=[];try{for(var t=g(this.handle.entries()),i,n,o;i=!(n=yield t.next()).done;i=!1){let[r,s]=n.value;e.push(new d(s))}}catch(n){o=[n]}finally{try{i&&(n=t.return)&&(yield n.call(t))}finally{if(o)throw o[0]}}return new p(e)})}verityPermissions(e){return c(this,null,function*(){if((yield this.handle.queryPermission({mode:e}))!=="granted"&&(yield this.handle.requestPermission({mode:e}))==="denied")throw new Error("Read permissions denied")})}saveBookmark(){return c(this,null,function*(){if(this.bookmarkId)return this.bookmarkId;let e=yield y.connect();try{return yield e.put(w,this.handle,this.generateBookmarkId())}finally{e.close()}})}deleteBookmark(){return c(this,null,function*(){if(!this.bookmarkId)return;let e=yield y.connect();try{let t=yield e.delete(w,this.bookmarkId)}finally{e.close()}})}generateBookmarkId(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}},p=class{constructor(e){this.items=e}count(){return this.items.length}at(e){return this.items[e]}},b=class{static canOpen(){return typeof window.showOpenFilePicker!="undefined"}static canSave(){return typeof window.showSaveFilePicker!="undefined"}static canPickFolder(){return typeof window.showDirectoryPicker!="undefined"}static selectFolderDialog(e){return c(this,null,function*(){let t={startIn:(e==null?void 0:e.handle)||void 0},i=yield window.showDirectoryPicker(t);return new d(i)})}static openFileDialog(e,t,i,n){return c(this,null,function*(){let o={startIn:(e==null?void 0:e.handle)||void 0,multiple:t,excludeAcceptAllOption:n,types:i||void 0},r=yield window.showOpenFilePicker(o);return new p(r.map(s=>new d(s)))})}static saveFileDialog(e,t,i,n){return c(this,null,function*(){let o={startIn:(e==null?void 0:e.handle)||void 0,suggestedName:t||void 0,excludeAcceptAllOption:n,types:i||void 0},r=yield window.showSaveFilePicker(o);return new d(r)})}static openBookmark(e){return c(this,null,function*(){let t=yield y.connect();try{let i=yield t.get(w,e);return i&&new d(i,e)}finally{t.close()}})}};export{b as StorageProvider};
//# sourceMappingURL=Storage.js.map
