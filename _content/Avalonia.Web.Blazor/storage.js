var a=(c,e,t)=>new Promise((r,n)=>{var s=l=>{try{i(t.next(l))}catch(p){n(p)}},o=l=>{try{i(t.throw(l))}catch(p){n(p)}},i=l=>l.done?r(l.value):Promise.resolve(l.value).then(s,o);i((t=t.apply(c,e)).next())}),S=(c,e,t)=>(e=c[Symbol.asyncIterator],t=(r,n)=>(n=c[r])&&(e[r]=s=>new Promise((o,i,l)=>(s=n.call(c,s),l=s.done,Promise.resolve(s.value).then(p=>o({value:p,done:l}),i)))),e?e.call(c):(c=c[Symbol.iterator](),e={},t("next"),t("return"),e));var w=class{constructor(e){this.database=e}openStore(e,t){return this.database.transaction(e,t).objectStore(e)}put(e,t,r){return a(this,null,function*(){let n=this.openStore(e,"readwrite");return yield new Promise((s,o)=>{let i=n.put(t,r);i.onsuccess=()=>{s(i.result)},i.onerror=()=>{o(i.error)}})})}get(e,t){let r=this.openStore(e,"readonly");return new Promise((n,s)=>{let o=r.get(t);o.onsuccess=()=>{n(o.result)},o.onerror=()=>{s(o.error)}})}delete(e,t){return a(this,null,function*(){let r=this.openStore(e,"readwrite");return yield new Promise((n,s)=>{let o=r.delete(t);o.onsuccess=()=>{n()},o.onerror=()=>{s(o.error)}})})}close(){this.database.close()}},y=class{constructor(e,t){this.databaseName=e;this.objectStores=t}connect(){return a(this,null,function*(){let e=window.indexedDB.open(this.databaseName,1);return e.onupgradeneeded=t=>{let r=t.target.result;this.objectStores.forEach(n=>{r.createObjectStore(n)})},yield new Promise((t,r)=>{e.onsuccess=n=>{t(new w(n.target.result))},e.onerror=n=>{r(n.target.error)}})})}},m="fileBookmarks",g=new y("AvaloniaDb",[m]);var d=class{constructor(e,t){this.handle=e;this.bookmarkId=t}get name(){return this.handle.name}get kind(){return this.handle.kind}static openRead(e){return a(this,null,function*(){if(!(e.handle instanceof FileSystemFileHandle))throw new Error("StorageItem is not a file");return yield e.verityPermissions("read"),yield e.handle.getFile()})}static openWrite(e){return a(this,null,function*(){if(!(e.handle instanceof FileSystemFileHandle))throw new Error("StorageItem is not a file");return yield e.verityPermissions("readwrite"),yield e.handle.createWritable({keepExistingData:!0})})}static getProperties(e){return a(this,null,function*(){let t=e.handle instanceof FileSystemFileHandle&&(yield e.handle.getFile());return t?{Size:t.size,LastModified:t.lastModified,Type:t.type}:null})}static getItems(e){return a(this,null,function*(){if(e.handle.kind!=="directory")return new u([]);let t=[];try{for(var r=S(e.handle.entries()),n,s,o;n=!(s=yield r.next()).done;n=!1){let[,i]=s.value;t.push(new d(i))}}catch(s){o=[s]}finally{try{n&&(s=r.return)&&(yield s.call(r))}finally{if(o)throw o[0]}}return new u(t)})}verityPermissions(e){return a(this,null,function*(){if((yield this.handle.queryPermission({mode:e}))!=="granted"&&(yield this.handle.requestPermission({mode:e}))==="denied")throw new Error("Permissions denied")})}static saveBookmark(e){return a(this,null,function*(){if(e.bookmarkId)return e.bookmarkId;let t=yield g.connect();try{return yield t.put(m,e.handle,e.generateBookmarkId())}finally{t.close()}})}static deleteBookmark(e){return a(this,null,function*(){if(!e.bookmarkId)return;let t=yield g.connect();try{yield t.delete(m,e.bookmarkId)}finally{t.close()}})}generateBookmarkId(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}},u=class{constructor(e){this.items=e}static itemsArray(e){return e.items}};var b=class{static selectFolderDialog(e){return a(this,null,function*(){var n;let t={startIn:(n=e==null?void 0:e.handle)!=null?n:void 0},r=yield window.showDirectoryPicker(t);return new d(r)})}static openFileDialog(e,t,r,n){return a(this,null,function*(){var i;let s={startIn:(i=e==null?void 0:e.handle)!=null?i:void 0,multiple:t,excludeAcceptAllOption:n,types:r!=null?r:void 0},o=yield window.showOpenFilePicker(s);return new u(o.map(l=>new d(l)))})}static saveFileDialog(e,t,r,n){return a(this,null,function*(){var i;let s={startIn:(i=e==null?void 0:e.handle)!=null?i:void 0,suggestedName:t!=null?t:void 0,excludeAcceptAllOption:n,types:r!=null?r:void 0},o=yield window.showSaveFilePicker(s);return new d(o)})}static openBookmark(e){return a(this,null,function*(){let t=yield g.connect();try{let r=yield t.get(m,e);return r&&new d(r,e)}finally{t.close()}})}static createAcceptType(e,t){let r={};return t.forEach(n=>{r[n]=[]}),{description:e,accept:r}}};export{d as StorageItem,u as StorageItems,b as StorageProvider};
//# sourceMappingURL=storage.js.map
