var m=(b,e,t)=>new Promise((n,i)=>{var o=s=>{try{a(t.next(s))}catch(u){i(u)}},r=s=>{try{a(t.throw(s))}catch(u){i(u)}},a=s=>s.done?n(s.value):Promise.resolve(s.value).then(o,r);a((t=t.apply(b,e)).next())});var v=class{constructor(e,t,n){this.renderLoopEnabled=!1;this.renderLoopRequest=0;if(this.htmlCanvas=t,this.renderFrameCallback=n,e){let i=v.createWebGLContext(t);if(!i){console.error("Failed to create WebGL context");return}let o=globalThis.AvaloniaGL;o.makeContextCurrent(i);let r=o.currentContext.GLctx,a=r.getParameter(r.FRAMEBUFFER_BINDING);this.glInfo={context:i,fboId:a?a.id:0,stencil:r.getParameter(r.STENCIL_BITS),sample:0,depth:r.getParameter(r.DEPTH_BITS)}}}static initGL(e,t,n){let i=v.init(!0,e,t,n);return!i||!i.glInfo?null:i.glInfo}static init(e,t,n,i){let o=t;if(!o)return console.error("No canvas element was provided."),null;v.elements||(v.elements=new Map),v.elements.set(n,t);let r=new v(e,t,i);return o.Canvas=r,r}setEnableRenderLoop(e){this.renderLoopEnabled=e,e?this.requestAnimationFrame():this.renderLoopRequest!==0&&(window.cancelAnimationFrame(this.renderLoopRequest),this.renderLoopRequest=0)}requestAnimationFrame(e){e!==void 0&&this.renderLoopEnabled!==e&&this.setEnableRenderLoop(e),this.renderLoopRequest===0&&(this.renderLoopRequest=window.requestAnimationFrame(()=>{var t,n;this.htmlCanvas.width!==this.newWidth&&(this.htmlCanvas.width=(t=this.newWidth)!=null?t:0),this.htmlCanvas.height!==this.newHeight&&(this.htmlCanvas.height=(n=this.newHeight)!=null?n:0),this.renderFrameCallback(),this.renderLoopRequest=0,this.renderLoopEnabled&&this.requestAnimationFrame()}))}setCanvasSize(e,t){this.renderLoopRequest!==0&&(window.cancelAnimationFrame(this.renderLoopRequest),this.renderLoopRequest=0),this.newWidth=e,this.newHeight=t,this.htmlCanvas.width!==this.newWidth&&(this.htmlCanvas.width=this.newWidth),this.htmlCanvas.height!==this.newHeight&&(this.htmlCanvas.height=this.newHeight),this.requestAnimationFrame()}static setCanvasSize(e,t,n){let i=e;!i||!i.Canvas||i.Canvas.setCanvasSize(t,n)}static requestAnimationFrame(e,t){let n=e;!n||!n.Canvas||n.Canvas.requestAnimationFrame(t)}static createWebGLContext(e){let t={alpha:1,depth:1,stencil:8,antialias:0,premultipliedAlpha:1,preserveDrawingBuffer:0,preferLowPowerToHighPerformance:0,failIfMajorPerformanceCaveat:0,majorVersion:2,minorVersion:0,enableExtensionsByDefault:1,explicitSwapControl:0,renderViaOffscreenBackBuffer:1},n=globalThis.AvaloniaGL,i=n.createContext(e,t);return!i&&t.majorVersion>1&&(console.warn("Falling back to WebGL 1.0"),t.majorVersion=1,t.minorVersion=0,i=n.createContext(e,t)),i}},d=class{static observe(e,t,n){if(!e||!n)return;d.lastMove=Date.now(),n(e.clientWidth,e.clientHeight);let i=o=>{Date.now()-d.lastMove>33&&(n(e.clientWidth,e.clientHeight),d.lastMove=Date.now())};window.addEventListener("resize",i)}static unobserve(e){if(!e||!d.observer)return;let t=d.elements.get(e);t&&(d.elements.delete(e),d.observer.unobserve(t))}static init(){d.observer||(d.elements=new Map,d.observer=new ResizeObserver(e=>{for(let t of e)d.invoke(t.target)}))}static invoke(e){let n=e.SizeWatcher;if(!(!n||!n.callback))return n.callback(e.clientWidth,e.clientHeight)}},p=class{static getDpi(){return window.devicePixelRatio}static start(e){return p.lastDpi=window.devicePixelRatio,p.timerId=window.setInterval(p.update,1e3),p.callback=e,p.lastDpi}static stop(){window.clearInterval(p.timerId)}static update(){if(!p.callback)return;let e=window.devicePixelRatio,t=p.lastDpi;p.lastDpi=e,Math.abs(t-e)>.001&&p.callback(t,e)}};var y=class{static getCaretCoordinates(e,t,n){var h,l;if(!S)throw new Error("textarea-caret-position#getCaretCoordinates should only be called in a browser");let i=(h=n==null?void 0:n.debug)!=null?h:!1;if(i){let f=document.querySelector("#input-textarea-caret-position-mirror-div");f&&((l=f.parentNode)==null||l.removeChild(f))}let o=document.createElement("div");o.id="input-textarea-caret-position-mirror-div",document.body.appendChild(o);let r=o.style,a=window.getComputedStyle?window.getComputedStyle(e):e.currentStyle,s=e.nodeName==="INPUT";r.whiteSpace="pre-wrap",s||(r.wordWrap="break-word"),r.position="absolute",i||(r.visibility="hidden"),I.forEach(f=>{if(s&&f==="lineHeight")if(a.boxSizing==="border-box"){let H=parseInt(a.height),T=parseInt(a.paddingTop)+parseInt(a.paddingBottom)+parseInt(a.borderTopWidth)+parseInt(a.borderBottomWidth),M=T+parseInt(a.lineHeight);H>M?r.lineHeight=`${H-T}px`:H===M?r.lineHeight=a.lineHeight:r.lineHeight="0"}else r.lineHeight=a.height;else r[f]=a[f]}),k?e.scrollHeight>parseInt(a.height)&&(r.overflowY="scroll"):r.overflow="hidden",o.textContent=e.value.substring(0,t),s&&(o.textContent=o.textContent.replace(/\s/g,"\xA0"));let u=document.createElement("span");u.textContent=e.value.substring(t)||".",o.appendChild(u);let c={top:u.offsetTop+parseInt(a.borderTopWidth),left:u.offsetLeft+parseInt(a.borderLeftWidth),height:parseInt(a.lineHeight)};return i?u.style.backgroundColor="#aaa":document.body.removeChild(o),c}},I=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing","tabSize","MozTabSize"],S=typeof window!="undefined",k=S&&window.mozInnerScreenX!=null;var E=class{static subscribeKeyEvents(e,t,n){let i=r=>{t(r.code,r.key,this.getModifiers(r))&&r.preventDefault()};e.addEventListener("keydown",i);let o=r=>{n(r.code,r.key,this.getModifiers(r))&&r.preventDefault()};return e.addEventListener("keyup",o),()=>{e.removeEventListener("keydown",i),e.removeEventListener("keyup",o)}}static subscribeTextEvents(e,t,n,i,o){let r=c=>{let h=c;t(h.type,h.data)&&c.preventDefault()};e.addEventListener("input",r);let a=c=>{n(c)&&c.preventDefault()};e.addEventListener("compositionstart",a);let s=c=>{i(c)&&c.preventDefault()};e.addEventListener("compositionupdate",s);let u=c=>{o(c)&&c.preventDefault()};return e.addEventListener("compositionend",u),()=>{e.removeEventListener("input",r),e.removeEventListener("compositionstart",a),e.removeEventListener("compositionupdate",s),e.removeEventListener("compositionend",u)}}static subscribePointerEvents(e,t,n,i,o,r){let a=l=>{t(l),l.preventDefault()},s=l=>{n(l),l.preventDefault()},u=l=>{i(l),l.preventDefault()},c=l=>{o(l),l.preventDefault()},h=l=>{r(l),l.preventDefault()};return e.addEventListener("pointermove",a),e.addEventListener("pointerdown",s),e.addEventListener("pointerup",u),e.addEventListener("wheel",h),e.addEventListener("pointercancel",c),()=>{e.removeEventListener("pointerover",a),e.removeEventListener("pointerdown",s),e.removeEventListener("pointerup",u),e.removeEventListener("pointercancel",c),e.removeEventListener("wheel",h)}}static subscribeInputEvents(e,t){let n=i=>{t(i.value)&&i.preventDefault()};return e.addEventListener("input",n),()=>{e.removeEventListener("input",n)}}static getCoalescedEvents(e){return e.getCoalescedEvents()}static clearInput(e){e.value=""}static focusElement(e){e.focus()}static setCursor(e,t){t==="pointer"?e.style.removeProperty("cursor"):e.style.cursor=t}static setBounds(e,t,n,i,o,r){e.style.left=t.toFixed(0)+"px",e.style.top=n.toFixed(0)+"px";let{left:a,top:s}=y.getCaretCoordinates(e,r);e.style.left=(t-a).toFixed(0)+"px",e.style.top=(n-s).toFixed(0)+"px"}static hide(e){e.style.display="none"}static show(e){e.style.display="block"}static setSurroundingText(e,t,n,i){!e||(e.value=t,e.setSelectionRange(n,i),e.style.width="20px",e.style.width=`${e.scrollWidth}px`)}static getModifiers(e){let t=0;return e.ctrlKey&&(t|=2),e.altKey&&(t|=1),e.shiftKey&&(t|=4),e.metaKey&&(t|=8),t}};var L=class{static addClass(e,t){e.classList.add(t)}static createAvaloniaHost(e){let t=Math.random().toString(36).replace(/[^a-z]+/g,"").substr(2,10);e.classList.add("avalonia-container"),e.tabIndex=0,e.oncontextmenu=function(){return!1},e.style.overflow="hidden",e.style.touchAction="none";let n=document.createElement("canvas");n.id=`canvas${t}`,n.classList.add("avalonia-canvas"),n.style.backgroundColor="#ccc",n.style.width="100%",n.style.position="absolute";let i=document.createElement("div");i.id=`nativeHost${t}`,i.classList.add("avalonia-native-host"),i.style.left="0px",i.style.top="0px",i.style.width="100%",i.style.height="100%",i.style.position="absolute";let o=document.createElement("input");return o.id=`inputElement${t}`,o.classList.add("avalonia-input-element"),o.autocapitalize="none",o.type="text",o.spellcheck=!1,o.style.padding="0",o.style.margin="0",o.style.position="absolute",o.style.overflow="hidden",o.style.borderStyle="hidden",o.style.outline="none",o.style.background="transparent",o.style.color="transparent",o.style.display="none",o.style.height="20px",o.style.zIndex="-1",o.onpaste=function(){return!1},o.oncopy=function(){return!1},o.oncut=function(){return!1},e.prepend(o),e.prepend(i),e.prepend(n),{host:e,canvas:n,nativeHost:i,inputElement:o}}};var g=class{static canShowOpenFilePicker(){return typeof window.showOpenFilePicker!="undefined"}static canShowSaveFilePicker(){return typeof window.showSaveFilePicker!="undefined"}static canShowDirectoryPicker(){return typeof window.showDirectoryPicker!="undefined"}};var w=class{static seek(e,t){return m(this,null,function*(){return yield e.seek(t)})}static truncate(e,t){return m(this,null,function*(){return yield e.truncate(t)})}static close(e){return m(this,null,function*(){return yield e.close()})}static write(e,t){return m(this,null,function*(){let n=new Uint8Array(t.byteLength);t.copyTo(n);let i={type:"write",data:n};return yield e.write(i)})}static byteLength(e){return e.size}static sliceArrayBuffer(e,t,n){return m(this,null,function*(){let i=yield e.slice(t,t+n).arrayBuffer();return new Uint8Array(i)})}static toMemoryView(e){return e}};var x=class{},C=class{static createDefaultChild(e){return document.createElement("div")}static createAttachment(){return new x}static initializeWithChildHandle(e,t){e._child=t,e._child.style.position="absolute"}static attachTo(e,t){e._host&&e._child&&e._host.removeChild(e._child),e._host=t,e._host&&e._child&&e._host.appendChild(e._child)}static showInBounds(e,t,n,i,o){e._child&&(e._child.style.top=`${n}px`,e._child.style.left=`${t}px`,e._child.style.width=`${i}px`,e._child.style.height=`${o}px`,e._child.style.display="block")}static hideWithSize(e,t,n){e._child&&(e._child.style.width=`${t}px`,e._child.style.height=`${n}px`,e._child.style.display="none")}static releaseChild(e){e._child&&(e._child=void 0)}};function O(b){return m(this,null,function*(){b.setModuleImports("avalonia",{Caniuse:g,Canvas:v,InputHelper:E,SizeWatcher:d,DpiWatcher:p,AvaloniaDOM:L,StreamHelper:w,NativeControlHost:C})})}export{L as AvaloniaDOM,g as Caniuse,v as Canvas,p as DpiWatcher,E as InputHelper,C as NativeControlHost,d as SizeWatcher,w as StreamHelper,O as registerAvaloniaModule};
//# sourceMappingURL=avalonia.js.map
